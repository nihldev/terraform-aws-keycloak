#######################
# General Configuration
#######################

# Name prefix for all resources
name = "myapp"

# Environment name (dev, staging, prod)
environment = "dev"

# Additional tags for all resources
# tags = {
#   Project = "MyProject"
#   Owner   = "team@example.com"
# }

#######################
# Networking
#######################

# VPC and subnet IDs (required - use your existing VPC)
# vpc_id             = "vpc-xxxxx"
# public_subnet_ids  = ["subnet-xxxxx", "subnet-yyyyy"]
# private_subnet_ids = ["subnet-aaaaa", "subnet-bbbbb"]

# CIDR blocks allowed to access Keycloak
# Default allows all - RESTRICT THIS IN PRODUCTION!
allowed_cidr_blocks = ["0.0.0.0/0"]

# ACM certificate ARN for HTTPS (optional)
# certificate_arn = "arn:aws:acm:us-east-1:123456789012:certificate/xxxxx"

# ALB access logs (optional)
# alb_access_logs_enabled = true
# alb_access_logs_bucket  = "my-alb-logs-bucket"
# alb_access_logs_prefix  = "keycloak"

# ALB deletion protection (defaults to true for prod)
# alb_deletion_protection = true

# ALB session stickiness (not typically needed for Keycloak)
# alb_stickiness_enabled  = false
# alb_stickiness_duration = 86400

# WAF WebACL ARN (REQUIRED for production)
# waf_acl_arn = "arn:aws:wafv2:us-east-1:123456789012:regional/webacl/keycloak/xxxxx"

#######################
# High Availability
#######################

# Enable multi-AZ deployment
multi_az = false

#######################
# ECS Configuration
#######################

# Keycloak version to deploy
keycloak_version = "26.0"

# Number of Keycloak instances
desired_count = 2

# ECS task resources
# dev:  task_cpu = 512,  task_memory = 1024
# prod: task_cpu = 2048, task_memory = 4096
task_cpu    = 1024
task_memory = 2048

# Enable CloudWatch Container Insights
# enable_container_insights = true

# CloudWatch log retention (defaults to 30 for prod, 7 for non-prod)
# cloudwatch_log_retention_days = 30

# SNS topic for CloudWatch alarms
# alarm_sns_topic_arn = "arn:aws:sns:us-east-1:123456789012:alerts"

# Health check configuration
# health_check_grace_period_seconds = 600
# health_check_path = "/health/ready"

# Autoscaling max capacity (defaults to desired_count * 3)
# autoscaling_max_capacity = 6

#######################
# Database Configuration
#######################

# Database type: rds, aurora, or aurora-serverless
database_type = "rds"

# RDS/Aurora Provisioned instance class
db_instance_class = "db.t4g.micro"

# Aurora Serverless v2 capacity (only for aurora-serverless)
db_capacity_min = 0.5
db_capacity_max = 2

# Aurora replica count (null = auto based on multi_az)
# aurora_replica_count = 1

# Aurora backtrack window in hours (null = auto: 24h prod, 0 non-prod)
# aurora_backtrack_window = 24

# RDS storage configuration
db_allocated_storage = 20
# db_max_allocated_storage = 100

# PostgreSQL engine version
# db_engine_version = "16.3"

# Additional PostgreSQL parameters
# db_parameters = [
#   { name = "work_mem", value = "256MB" }
# ]

# Backup configuration
db_backup_retention_period = 7
# db_backup_window      = "03:00-04:00"
# db_maintenance_window = "sun:04:00-sun:05:00"

# Database protection
# db_deletion_protection = true
# db_skip_final_snapshot = false

# KMS encryption keys
# db_kms_key_id      = "arn:aws:kms:us-east-1:123456789012:key/xxxxx"
# secrets_kms_key_id = "arn:aws:kms:us-east-1:123456789012:key/xxxxx"

# Performance Insights (null = auto based on database type)
db_performance_insights_retention_period = 7

# IAM database authentication
# db_iam_database_authentication_enabled = false

#######################
# Keycloak Configuration
#######################

# Admin username
# keycloak_admin_username = "admin"

# Log level (INFO, DEBUG, WARN, ERROR)
keycloak_loglevel = "INFO"

# Hostname for Keycloak (required with HTTPS)
# keycloak_hostname = "auth.example.com"

# Additional environment variables
# keycloak_extra_env_vars = {
#   KC_FEATURES = "preview"
# }

# Cache configuration (required for multi-instance)
# keycloak_cache_enabled = true
# keycloak_cache_stack   = "jdbc-ping"

# Database connection pool
# db_pool_initial_size = 5
# db_pool_min_size     = 5
# db_pool_max_size     = 20

#######################
# SES Email Configuration
#######################

# Enable SES email integration
# enable_ses = false

# SES domain (required if enable_ses = true)
# ses_domain = "example.com"

# Optional: Specific email address to verify
# ses_email_identity = "noreply@example.com"

# From email address
# ses_from_email = "keycloak@example.com"

# Route53 zone ID for automatic DNS records
# ses_route53_zone_id = "Z1234567890ABC"

# Enable SES configuration set for tracking
# ses_configuration_set_enabled = false

#######################
# Custom Image / ECR
#######################

# Custom Keycloak image URI
# keycloak_image = "123456789.dkr.ecr.us-east-1.amazonaws.com/keycloak:v1.0.0"

# Create ECR repository for custom images
# create_ecr_repository = false

# ECR configuration
# ecr_image_tag_mutability = "MUTABLE"
# ecr_scan_on_push         = true
# ecr_image_retention_count = 30
# ecr_image_tag_prefixes   = ["v", "release", "prod", "staging", "dev"]
# ecr_kms_key_id           = ""
# ecr_allowed_account_ids  = []
